"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Telegram –±–æ—Ç–∞ –¥–ª—è LatePoint Integration

–í–ê–ñ–ù–û: –≠—Ç–æ—Ç —Ñ–∞–π–ª —è–≤–ª—è–µ—Ç—Å—è —à–∞–±–ª–æ–Ω–æ–º!

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª: cp config.example.py config.py
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –≤ config.py
3. –ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ config.py –≤ Git!
"""

import os
from pathlib import Path

# ============================================================================
# –ë–ê–ó–û–í–´–ï –ù–ê–°–¢–†–û–ô–ö–ò
# ============================================================================

# –ö–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞
BASE_DIR = Path(__file__).resolve().parent

# –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: 'development' –∏–ª–∏ 'production'
MODE = os.getenv('MODE', 'production')

# ============================================================================
# TELEGRAM BOT
# ============================================================================

# –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ (–ø–æ–ª—É—á–∏—Ç–µ –æ—Ç @BotFather)
# –ü—Ä–∏–º–µ—Ä: '1234567890:ABCdefGHIjklMNOpqrsTUVwxyz'
BOT_TOKEN = os.getenv('BOT_TOKEN', 'YOUR_BOT_TOKEN_HERE')

# ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –±–æ—Ç–∞ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
ADMIN_IDS = os.getenv('ADMIN_IDS', '').split(',') if os.getenv('ADMIN_IDS') else []

# ============================================================================
# WORDPRESS API
# ============================================================================

# URL WordPress —Å–∞–π—Ç–∞ —Å LatePoint
WP_SITE_URL = os.getenv('WP_SITE_URL', 'https://blagovest.net')

# API endpoint –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å LatePoint
WP_API_URL = os.getenv(
    'WP_API_URL',
    f'{WP_SITE_URL}/wp-json/latepoint-telegram/v1'
)

# WordPress Nonce –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
WP_NONCE = os.getenv('WP_NONCE', '')

# WordPress API Key (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
WP_API_KEY = os.getenv('WP_API_KEY', '')

# ============================================================================
# WEBHOOK SECURITY
# ============================================================================

# –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤ –æ—Ç WordPress
# –î–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –≤ WordPress –ø–ª–∞–≥–∏–Ω–µ
# –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω—É—é —Å—Ç—Ä–æ–∫—É: openssl rand -hex 32
WEBHOOK_SECRET = os.getenv('WEBHOOK_SECRET', 'YOUR_WEBHOOK_SECRET_HERE')

# ============================================================================
# DATABASE
# ============================================================================

# URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite
DATABASE_URL = os.getenv(
    'DATABASE_URL',
    f'sqlite+aiosqlite:///{BASE_DIR}/bot_data.db'
)

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
AUTO_CREATE_TABLES = os.getenv('AUTO_CREATE_TABLES', 'true').lower() == 'true'

# ============================================================================
# WEB SERVER (–¥–ª—è –ø—Ä–∏—ë–º–∞ –≤–µ–±—Ö—É–∫–æ–≤)
# ============================================================================

# Host –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ (0.0.0.0 = –≤—Å–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)
HOST = os.getenv('HOST', '0.0.0.0')

# Port –¥–ª—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
PORT = int(os.getenv('PORT', '8000'))

# –ë–∞–∑–æ–≤—ã–π URL –±–æ—Ç–∞ –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Telegram webhook mode)
WEBHOOK_URL = os.getenv('WEBHOOK_URL', f'https://yourdomain.com/webhook/{BOT_TOKEN}')

# ============================================================================
# –õ–û–ì–ò–†–û–í–ê–ù–ò–ï
# ============================================================================

# –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL = os.getenv('LOG_LEVEL', 'INFO')

# –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤
LOG_FILE = BASE_DIR / 'logs' / 'bot.log'

# –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤
LOG_FORMAT = '%(asctime)s - %(name)s - %(levelname)s - %(message)s'

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ª–æ–≥–æ–≤ (–≤ –±–∞–π—Ç–∞—Ö)
LOG_MAX_BYTES = int(os.getenv('LOG_MAX_BYTES', 10 * 1024 * 1024))  # 10 MB

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ backup —Ñ–∞–π–ª–æ–≤ –ª–æ–≥–æ–≤
LOG_BACKUP_COUNT = int(os.getenv('LOG_BACKUP_COUNT', 5))

# ============================================================================
# –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
# ============================================================================

# –í—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø–µ—Ä–µ–¥ —Å–æ–±—ã—Ç–∏—è–º–∏ (–≤ –º–∏–Ω—É—Ç–∞—Ö)
REMINDER_TIMES = [
    60 * 24,  # –ó–∞ 24 —á–∞—Å–∞
    60,       # –ó–∞ 1 —á–∞—Å
    15,       # –ó–∞ 15 –º–∏–Ω—É—Ç
]

# –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
CHECK_INTERVAL = int(os.getenv('CHECK_INTERVAL', 60))

# –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –≤ –º–∏–Ω—É—Ç–∞—Ö (–¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞)
REMINDER_CHECK_INTERVAL = int(os.getenv('REMINDER_CHECK_INTERVAL', 5))

# ============================================================================
# –õ–û–ö–ê–õ–ò–ó–ê–¶–ò–Ø
# ============================================================================

# –Ø–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
DEFAULT_LANGUAGE = os.getenv('DEFAULT_LANGUAGE', 'ru')

# –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å
TIMEZONE = os.getenv('TIMEZONE', 'Europe/Moscow')

# ============================================================================
# –°–û–û–ë–©–ï–ù–ò–Ø –ë–û–¢–ê
# ============================================================================

# –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞
MESSAGES = {
    'welcome': (
        'üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–æ—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞–Ω—è—Ç–∏—è—Ö!\n\n'
        '–î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–∞–º –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ '
        '–≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –Ω–∞ —Å–∞–π—Ç–µ –∏–ª–∏ —É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.\n\n'
        '–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ '
        '–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:\n'
        '/start –í–ê–®_–¢–û–ö–ï–ù'
    ),
    'help': (
        'üìã <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>\n\n'
        '/today - –£—Ä–æ–∫–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è\n'
        '/week - –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é\n'
        '/settings - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n'
        '/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n\n'
        'üí° –í—ã —Ç–∞–∫–∂–µ –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è '
        '–æ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å—è—Ö, –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–Ω—è—Ç–∏—è–º–∏.'
    ),
    'not_registered': (
        '‚ùå –í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ.\n\n'
        '–î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:\n'
        '/start –í–ê–®_–¢–û–ö–ï–ù\n\n'
        '–¢–æ–∫–µ–Ω –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –Ω–∞ —Å–∞–π—Ç–µ.'
    ),
    'registration_success': (
        '‚úÖ <b>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!</b>\n\n'
        'üë§ –ò–º—è: {name}\n'
        'üé≠ –¢–∏–ø –∞–∫–∫–∞—É–Ω—Ç–∞: {user_type}\n\n'
        '–¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–Ω—è—Ç–∏—è—Ö.\n'
        '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥.'
    ),
    'token_expired': (
        '‚ùå <b>–¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫</b>\n\n'
        '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ '
        '–≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –Ω–∞ —Å–∞–π—Ç–µ –∏–ª–∏ —É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.'
    ),
    'invalid_token': (
        '‚ùå <b>–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω</b>\n\n'
        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.\n'
        '–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –∑–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω.'
    ),
}

# ============================================================================
# REDIS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è)
# ============================================================================

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
USE_REDIS = os.getenv('USE_REDIS', 'false').lower() == 'true'

# URL Redis —Å–µ—Ä–≤–µ—Ä–∞
REDIS_URL = os.getenv('REDIS_URL', 'redis://localhost:6379/0')

# ============================================================================
# RATE LIMITING
# ============================================================================

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
RATE_LIMIT_PER_USER = int(os.getenv('RATE_LIMIT_PER_USER', 30))

# ============================================================================
# FEATURES FLAGS
# ============================================================================

# –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
ENABLE_AUTO_REMINDERS = os.getenv('ENABLE_AUTO_REMINDERS', 'true').lower() == 'true'

# –í–∫–ª—é—á–∏—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
ENABLE_WEB_DASHBOARD = os.getenv('ENABLE_WEB_DASHBOARD', 'false').lower() == 'true'

# –í–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (–ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏)
DEBUG = os.getenv('DEBUG', 'false').lower() == 'true'

# ============================================================================
# –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨
# ============================================================================

# –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ IP –∞–¥—Ä–µ—Å–∞ –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤ (–ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ = –≤—Å–µ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã)
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ webhook endpoint
ALLOWED_IPS = os.getenv('ALLOWED_IPS', '').split(',') if os.getenv('ALLOWED_IPS') else []

# –¢–∞–π–º–∞—É—Ç –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ WordPress (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
HTTP_TIMEOUT = int(os.getenv('HTTP_TIMEOUT', 30))

# ============================================================================
# –ü–†–û–í–ï–†–ö–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
# ============================================================================

def validate_config():
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
    –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞
    """
    errors = []

    if BOT_TOKEN == 'YOUR_BOT_TOKEN_HERE':
        errors.append("BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω! –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –æ—Ç @BotFather")

    if WEBHOOK_SECRET == 'YOUR_WEBHOOK_SECRET_HERE':
        errors.append("WEBHOOK_SECRET –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω! –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω—É—é —Å—Ç—Ä–æ–∫—É")

    if errors:
        print("\n" + "="*70)
        print("–û–®–ò–ë–ö–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò!")
        print("="*70)
        for error in errors:
            print(f"  ‚ùå {error}")
        print("="*70)
        print("\n–°–∫–æ–ø–∏—Ä—É–π—Ç–µ config.example.py –≤ config.py –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏")
        print("="*70 + "\n")
        raise ValueError("–ù–µ–≤–µ—Ä–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞")

    return True


if __name__ == "__main__":
    # –¢–µ—Å—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    try:
        validate_config()
        print("‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞")
    except ValueError as e:
        print(f"‚ùå {e}")
